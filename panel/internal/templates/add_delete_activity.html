{{ define "activities.html" }}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ .Title }}</title>
</head>
<body>
    <h1>{{ .Title }}</h1>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Message ID</th>
                <th>Title</th>
                <th>Prompt ID</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        {{ range .Data }}
            <tr>
                <td>{{ .ID }}</td>
                <td>{{ .MessageID }}</td>
                <td>{{ .Title }}</td>
                <td>{{ if .PromptMessageID }}{{ .PromptMessageID }}{{ else }}â€”{{ end }}</td>
                <td>
                    <form method="post" action="/dashboard/activities/{{ .ID }}" onsubmit="deleteActivity(`{{ .ID }}`); return false;" style="display:inline;">
                        <button type="submit" class="delete-btn">Delete</button>
                    </form>
                </td>
            </tr>
        {{ else }}
            <tr>
                <td colspan="4">No activities found.</td>
            </tr>
        {{ end }}
        </tbody>
    </table>

    <h2>Add Activity</h2>
    <form method="post" action="/dashboard/activities/" id="addForm">
        <label>Message ID:</label>
        <input type="number" name="message_id" required><br>
        <label>Title:</label>
        <input type="text" name="title" required><br>
        <label>Support Prompt ID (optional):</label>
        <input type="number" name="prompt_message_id"><br>
        <button type="submit">Add</button>
    </form>

    <script>
        document.getElementById('addForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = {
                id: parseInt(this.id.value),
                message_id: parseInt(this.message_id.value),
                title: this.title.value,
                prompt_message_id: this.prompt_message_id.value ? parseInt(this.prompt_message_id.value) : null
            };
            fetch(this.action, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            }).then(res => {
                if (res.ok) location.reload();
                else res.text().then(alert);
            });
        });

        function deleteActivity(id) {
            fetch(`/dashboard/activities/${id}`, { method: 'DELETE' }).then(res => {
                if (res.ok) location.reload();
                else res.text().then(alert);
            });
        }
    </script>
</body>
</html>
{{ end }}
